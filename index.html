<!DOCTYPE html>
<html>
  <head>
    <title>Prediccion Precios Pisos Form</title>
    <link
      href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
      integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="main2.css" />
  </head>
  <body>
    <div class="testbox">
      <form id="formulario" onsubmit="sendPostRequest(); return false;">
        <div class="banner">
          <h1>Formulario de predicción de precios de pisos</h1>
        </div>
        <div class="colums">
          <div class="item">
            <p>Metros Cuadrados</p>
            <div class="name-item">
              <input
                type="text"
                name="m2"
                id="m2"
              />
            </div>
          </div>
          <div class="item">
            <p>Habitaciones</p>
            <div class="name-item">
              <input type="text" id="rooms" name="rooms" />
            </div>
          </div>
          <div class="item">
            <p>Location</p>
            <div class="name-item">
              <select name="location">
                <option value="Verdun">Verdun</option>
                <option value="Dreta de l´Eixample">Dreta de l´Eixample</option>
                <option value="Baix Guinardó">Baix Guinardó</option>
                <option value="Sant Gervasi - Galvany">Sant Gervasi - Galvany</option>
                <option value="Font d´en Fargas">Font d´en Fargas</option>
                <option value="Taxonera">Taxonera</option>
                <option value="La Sagrera">La Sagrera</option>
                <option value="Guinardó">Guinardó</option>
                <option value="La Salut">La Salut</option>
                <option value="Putget - Farró">Putget - Farró</option>
                <option value="Vila de Gràcia">Vila de Gràcia</option>
                <option value="Esquerra Baixa de l´Eixample">Esquerra Baixa de l´Eixample</option>
                <option value="Roquetes">Roquetes</option>
                <option value="St. Pere - Sta. Caterina - El Born">St. Pere - Sta. Caterina - El Born</option>
                <option value="Carmel">Carmel</option>
                <option value="Sagrada Família">Sagrada Família</option>
                <option value="Esquerra Alta de l´Eixample">Esquerra Alta de l´Eixample</option>
                <option value="Tres Torres">Tres Torres</option>
                <option value="Sarrià">Sarrià</option>
                <option value="Gòtic">Gòtic</option>
                <option value="Sant Andreu">Sant Andreu</option>
                <option value="Vallcarca - Penitents">Vallcarca - Penitents</option>
              </select>
            </div>
          </div>
          <div class="item">
            <p>Lavabos</p>
            <div class="name-item">
              <input type="text" id="banos" name="banos" />
            </div>
          </div>
        </div>
        <div class="colums">
          <div class="question">
            <p>Ascensor</p>
            <div class="question-answer">
              <input
                type="radio"
                value="Si"
                id="ElevatorYes"
                name="ascensor"
              />
              <label for="ElevatorYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="ElevatorNo" name="ascensor" />
              <label for="ElevatorNo" class="radio"><span>No</span></label>
            </div>
          </div>
          <div class="question">
            <p>Parking</p>
            <div class="question-answer">
              <input type="radio" value="Si" id="ParkingYes" name="parking" />
              <label for="ParkingYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="ParkingNo" name="parking" />
              <label for="ParkingNo" class="radio"><span>No</span></label>
            </div>
          </div>
          <div class="question">
            <p>Aire Acondicionado</p>
            <div class="question-answer">
              <input type="radio" value="Si" id="CoolAirYes" name="acondicionado" />
              <label for="CoolAirYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="CoolAirNo" name="acondicionado" />
              <label for="CoolAirNo" class="radio"><span>No</span></label>
            </div>
          </div>

          <div class="question">
            <p>Transporte</p>
            <div class="question-answer">
              <input type="radio" value="Si" id="TransporteYes" name="transporte" />
              <label for="TransporteYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="TransporteNo" name="transporte" />
              <label for="TransporteNo" class="radio"><span>No</span></label>
            </div>
          </div>

          <div class="question">
            <p>Calefacción</p>
            <div class="question-answer">
              <input type="radio" value="Si" id="HeatingYes" name="calefaccion" />
              <label for="HeatingYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="HeatingNo" name="calefaccion" />
              <label for="HeatingNo" class="radio"><span>No</span></label>
            </div>
          </div>
        </div>
        <div class="colums">
          <div class="question">
            <p>Nueva Construcccion</p>
            <div class="question-answer">
              <input
                type="radio"
                value="Si"
                id="ConstructionYes"
                name="obarNueva"
              />
              <label for="ConstructionYes" class="radio"
                ><span>Si</span></label
              >
              <input
                type="radio"
                value="No"
                id="ConstructionNo"
                name="obarNueva"
              />
              <label for="ConstructionNo" class="radio"><span>No</span></label>
            </div>
          </div>
          <div class="question">
            <p>Piscina</p>
            <div class="question-answer">
              <input type="radio" value="Si" id="PoolYes" name="piscina" />
              <label for="PoolYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="PoolNo" name="piscina" />
              <label for="PoolNo" class="radio"><span>No</span></label>
            </div>
          </div>
          <div class="question">
            <p>Jardin</p>
            <div class="question-answer">
              <input type="radio" value="Si" id="YardYes" name="jardin" />
              <label for="YardYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="YardNo" name="jardin" />
              <label for="YardNo" class="radio"><span>No</span></label>
            </div>
          </div>
          <div class="question">
            <p>Balcony</p>
            <div class="question-answer">
              <input type="radio" value="Si" id="BalconyYes" name="terraza" />
              <label for="BalconyYes" class="radio"><span>Si</span></label>
              <input type="radio" value="No" id="BalconyNo" name="terraza" />
              <label for="BalconyNo" class="radio"><span>No</span></label>
            </div>
          </div>
        </div>
        <div id="testbox">
          <h2 id="prediction-header">Prediction:</h2>
          <p id="prediction-value">Loading...</p>
        </div>

        <div class="btn-block">
          <button type="submit" href="/">Submit</button>
        </div>
      </form>
    </div>

    <script>
      function sendPostRequest() {
        const formData = new FormData(document.getElementById("formulario"));

        var input = document.getElementById("m2").value;
        var floatValue = parseFloat(input.replace(",", "."));

        // Convierte los datos del formulario a un objeto JSON
        const data = {};
        formData.forEach((value, key) => {
          // Si el campo es una casilla de verificación y no está seleccionada, enviar "No"

          // Si el campo es rooms o banos, convertir a entero
          // Si el campo es m2 o eurom2, convertir a float
          if (key === "rooms" || key === "banos") {
            data[key] = parseInt(value);
          } else if (key === "m2" || key === "eurom2") {
            data[key] = parseFloat(value);
          } else {
            data[key] = value;
          }
        });

        // Convierte los datos del formulario a un objeto JSON

        // Envía la solicitud HTTP POST a tu aplicación Flask
        fetch("https://prediccionpisosia.ew.r.appspot.com/predict", {
          method: "POST",
          //mode: 'no-cors',
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json",
          },
          body: JSON.stringify(data),
        })
          .then((response) => response.json()) // Procesa la respuesta del servidor como JSON
          .then((data) => {
            // Aquí puedes procesar los datos devueltos por el servidor
            console.log(data);
            document.getElementById("prediction").innerHTML = data.prediction;
          })
          .catch((error) => {
            // Aquí puedes manejar cualquier error que ocurra durante la solicitud
            console.error(error);
          });
      }
    </script>
  </body>
</html>
